<!DOCTYPE html>
<html>

<head>
    <title>Culte Sale Widget</title>
    <link rel="stylesheet" href="https://unpkg.com/picnic">
</head>

<body style="margin: 10%;">
    <h1>USD / BNB price updater</h1>

    <form>
        <h2>**Please be carefull.</h2> 
        <label>By pressioning this button you will change the USD cents as current BNB converted cotation</label>
        <button type="button" id="updPrice" style="width: 100%;">Update</button>
    </form>
    <script src="https://cdn.ethers.io/scripts/ethers-v4.min.js" charset="utf-8" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
   <script>
        const desiredNetwork = '4' // '1' is the Ethereum main network ID, 4 is Rinkeby
        const binanceCotationContract = "0x61095B5ff1Af7C08d9c0F6258d197dbb0b6b9995" // UPDATE, this is pointing to Rinkeby

        // Detect whether the current browser is ethereum-compatible,
        // and handle the case where it isn't:
        if (typeof window.ethereum === 'undefined') {
            alert(
                'You need an Ethereum compatible browser, we recommend Metamask (works with your browser of choice) or Opera.'
            )
        } else {

            // In the case the user has MetaMask installed, you can easily
            // ask them to sign in and reveal their accounts:
            ethereum.enable()

                // Remember to handle the case they reject the request:
                .catch(function (reason) {
                    // This shouldn't happen, so you might want to log this...
                    alert('There was an issue signing you in.')
                })

                // In the case they approve the log-in request, you'll receive their accounts:
                .then(function (accounts) {
                    // You also should verify the user is on the correct network:
                    if (ethereum.networkVersion !== desiredNetwork) {
                        alert('This application requires the main network, please switch it in your MetaMask UI.')
                    }
                })
        }

        document.getElementById('updPrice').addEventListener('click', function () {
            const value = '2500000000000000';

            if (value == 0) {
                alert("Please select an amount to buy.")
                return
            }

            updatePrices(value, function (err, transaction) {
                if (err) {
                    return alert(`Sorry you weren't able to update! Please contact us for support.`)
                }
            })
        });

        async function updatePrices(value, callback) {

            let provider = new ethers.providers.Web3Provider(web3.currentProvider);
            var signer = provider.getSigner();
            let account = await signer.getAddress();
            let abi = [
                "function updateCent(uint256 _newValue) public",
            ];
            let BinanceCotationContract = new ethers.Contract(binanceCotationContract, abi, signer);

            console.log(await signer.getAddress());
            let tx;
            try {
                tx = await BinanceCotationContract.updateCent(account, {
                    value: ethers.utils.parseEther(value)
                });
            } catch (err) {
                alert(err.data.message);
            }
            let receipt = await tx.wait(1)
            if (receipt.status == 1) console.log("Price update confirmed, thank you!")
        }
    </script>
</body>

</html>